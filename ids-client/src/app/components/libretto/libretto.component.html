<br>
<h1>
  <i class="fas fa-book"></i>
  Libretto delle Misure
</h1>

<div class="container-fluid" style="max-height: 100%; margin-top: 3%">
  <div class="row" style="margin-bottom: 10px">
    <div *ngIf="(misureSource | async)?.isLoading">
      <h3>Loading</h3>
    </div>
    <div class="col-md">
      Completamento totale: 45%
    </div>

    <div class="col-md-6" style="text-align: center; margin-bottom: 10px">

      <button *ngIf="isRupLogged && !(misureSource | async)?.isLoading" type="button" class="btn btn-outline-warning btn-sm"
        style="float: right; top: 20%; position:relative" (click)='openDialogConfermaLibretto()'>Approva Misure</button>

      <button *ngIf="isDirettoreLogged && !(misureSource | async)?.isLoading" type="button" class="btn btn-outline-warning btn-sm"
        style="float: right; position:relative" (click)='openDialogInserimento()'>Inserisci nuova voce</button>
    </div>
  </div>
  <div class="row">

    <div class="col-md-12">

      <div class="example-container mat-elevation-z8 scrollbar-black bordered-black thin">

        <table mat-table [dataSource]="misure">


          <ng-container matColumnDef="no">
            <th mat-header-cell *matHeaderCellDef> No. </th>
            <td mat-cell *matCellDef="let element"> {{element.no}} </td>
          </ng-container>


          <ng-container matColumnDef="tariffa">
            <th mat-header-cell *matHeaderCellDef> Tariffa </th>
            <td mat-cell *matCellDef="let element"> {{element.tariffa}} </td>
          </ng-container>


          <ng-container matColumnDef="data">
            <th mat-header-cell *matHeaderCellDef> Data </th>
            <td mat-cell *matCellDef="let element"> {{element.data}} </td>
          </ng-container>

          <ng-container matColumnDef="designazione">
            <th mat-header-cell *matHeaderCellDef> Designazione dei Lavori </th>
            <td mat-cell *matCellDef="let element"> {{element.descrizione}} </td>
          </ng-container>

          <ng-container matColumnDef="categoriaContabile">
            <th mat-header-cell *matHeaderCellDef> Categoria Contabile </th>
            <td mat-cell *matCellDef="let element"> {{element.categoriaContabile}} </td>
          </ng-container>


          <ng-container matColumnDef="percentuale">
            <th mat-header-cell *matHeaderCellDef> Percentuale </th>
            <td mat-cell *matCellDef="let element"> {{element.percentuale}} </td>
          </ng-container>


          <ng-container matColumnDef="allegati">
            <th mat-header-cell *matHeaderCellDef> Allegati </th>
            <td mat-cell *matCellDef="let element"> <a href="javascript:;"><i class="align-middle fas fa-paperclip"
                  (click)="openDialogVisAllegati()"></i></a></td>
          </ng-container>


          <ng-container matColumnDef="riserva">
            <th mat-header-cell *matHeaderCellDef> Riserva </th>
            <td mat-cell *matCellDef="let element">
                <div class="row" style="justify-content: center">
                  <button mat-flat-button (click)="openDialogVisRiserva(element.riserva)">Vedi</button>
                </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="invalida">
            <th mat-header-cell *matHeaderCellDef> Invalida Misura </th>
            <td mat-cell *matCellDef="let element">
                <div class="row" style="justify-content: center">
                  <button mat-flat-button class="bg-warning" [disabled]='!element.invalidabile || !element.valida' (click)="openDialogInvalidaMisura(element.no)">Invalida</button>
                </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'bg-secondary':!row.valida,'bg-success text-white':row.approvata && row.valida}"></tr>


        </table>
      </div>

    </div>

  </div>
</div>
